@using DWM.Models.Repositories
@using App_Dominio.Repositories
@using App_Dominio.Enumeracoes
@model DWM.Models.Repositories.EnquadramentoViewModel
@{
    Layout = null;
    var classe = "";
    
}
<div class="panel panel-default margem-topo">
    <!-- Default panel contents -->
    <!-- Table -->
    <table class="table">
        <thead class="corvo text-white">
            <tr>
                <th class="text-center">Ação</th>
                <th class="text-center">Item</th>
                <th class="text-left">Conta</th>
                <th class="text-left">C.Custo</th>
                <th class="text-left">Histórico</th>
                <th class="text-center">Tipo</th>
                <th class="text-right">Valor</th>
            </tr>
        </thead>
        @foreach (EnquadramentoItemViewModel item in Model.EnquadramentoItems)
        {
            if (item.sequencial == Model.EnquadramentoItem.sequencial && TempData["operacao"] == "A")
            {
                classe = "alert alert-info";
            }
            else if (item.sequencial == Model.EnquadramentoItem.sequencial && TempData["operacao"] == "E")
            {
                classe = "alert alert-danger";
            }
            else
            {
                classe = "";
            }
            <tr class="@classe">
                <td class="col-md-1 col-sm-4 text-center">
                    <div class="row">
                        <div class="col-md-6"><a class="text-primary" href="#" onclick="EditItem(@item.sequencial);">Editar</a></div>
                        <div class="col-md-6"><a class="text-danger" href="#" onclick="DelItem(@item.sequencial);">Excluir</a></div>
                    </div>
                </td>
                <td class="col-md-1 col-sm-4 text-center">
                    <small>@item.sequencial</small>
                </td>
                <td class="col-md-4 col-sm-2">
                    <small>@(item.codigoPleno + "-" + item.descricao_planoConta)</small>
                </td>
                <td class="col-md-1 col-sm-2">
                    <small>@Html.Editor("descricao_ccusto", "TRUNC", new { text = item.descricao_centroCusto ?? "", width = 10 })</small>
                </td>
                <td class="col-md-3 col-sm-2">
                    <small>@item.descricao_historico</small>
                </td>
                <td class="col-md-1 col-sm-3 text-center">
                    <small>@item.tipoLancamento</small>
                </td>
                <td class="col-md-1 col-sm-2 text-right">
                    @if (item.valor.HasValue)
                    {
                        <small>@item.valor.Value.ToString("###,###,###,##0.00")</small>
                    }
                </td>
            </tr>
        }
    </table>
</div>

<script type="text/javascript">

    function EditItem(obj) {
        CarregandoIn();

        $("#nav-new").removeClass('active');
        $("#nav-edit").addClass("active");
        $("#nav-del").removeClass("active");

        var link = '@Url.Action("EditItem")';
        link = encodeURI(link + '?sequencial=' + obj + '&master=null&noCahce=' + new Date());

        $('#div-item').load(link);

        $(document).ajaxSuccess(function (event, xhr, settings) {
            $('#carregando').css("visibility", "hidden");
            $('#carregando').css("height", "0px");
            $('#carregando').css("margin-top", "0%");
            $('#carregando').css("margin-left", "0%");
        }).error(function () {
            $('#carregando').css("visibility", "hidden");
            $('#carregando').css("height", "0px");
            $('#carregando').css("margin-top", "0%");
            $('#carregando').css("margin-left", "0%");
        })
    }

    function DelItem(obj) {
        CarregandoIn();

        $("#nav-new").removeClass('active');
        $("#nav-edit").removeClass("active");
        $("#nav-del").addClass("active");

        var link = '@Url.Action("DeleteItem")';
        link = encodeURI(link + '?sequencial=' + obj + '&master=null&noCahce=' + new Date());

        $('#div-item').load(link);

        $(document).ajaxSuccess(function (event, xhr, settings) {
            $('#carregando').css("visibility", "hidden");
            $('#carregando').css("height", "0px");
            $('#carregando').css("margin-top", "0%");
            $('#carregando').css("margin-left", "0%");
        }).error(function () {
            $('#carregando').css("visibility", "hidden");
            $('#carregando').css("height", "0px");
            $('#carregando').css("margin-top", "0%");
            $('#carregando').css("margin-left", "0%");
        })
    }

</script>
@using DWM.Models.Repositories
@using App_Dominio.Repositories
@model PagedList<RazaoViewModel>
@{
    TransacaoRepository[] t = { new TransacaoRepository(), new TransacaoRepository() };
    t[0].url = "../Contabilidade/Create";
    t[0].nomeCurto = "Incluir";
    t[0].exibir = "S";
    t[0].referencia = "";

    t[1].url = "../Home/Default";
}
@Html.Partial("_AjaxAlert","")
<div class="x_panel">
    @Html.EditorFor(info => Model, "FORMULARIO", new { Brand = "Razão contábil", Descricao = "", Transacao = t })
    <div class="x_content">
        @using (Ajax.BeginForm("ListParam", "Razao", new AjaxOptions { HttpMethod = "get", UpdateTargetId = "div-list-static2" }, new { @role = "search", @id = "form000", @name = "form000" }))
            {
            <div class="container-cadastro">
                <div class="row clearfix">
                    <div class="col-md-6">
                        @Html.Editor("descricao_conta1", "PlanoContasAutoComplete", new { nextField = "descricao_centroCusto" })
                    </div>
                    <div class="col-md-6">
                        @Html.Editor("descricao_centroCusto1", "CentroCustoAutoComplete", new { nextField = "data1", prevField = "descricao_conta" })
                    </div>
                </div>
                <div class="row clearfix">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label" for="data1">Período</label>
                            <div class="row clearfix">
                                <div class="col-md-4">
                                    @Html.Editor("data1", "DATE", new { identificador = "data1", readOnly = "false", value = Request["data1"] == null || Request["data1"].Contains("%") ? Convert.ToDateTime(DateTime.Today.ToString("yyyy-MM-") + "01") : Convert.ToDateTime(Request["data1"]) })
                                </div>
                                <div class="col-md-1">
                                    à
                                </div>
                                <div class="col-md-5">
                                    @Html.Editor("data2", "DATE", new { identificador = "data2", readOnly = "false", value = Request["data2"] == null || Request["data2"].Contains("%") ? Convert.ToDateTime(DateTime.Today.AddMonths(1).ToString("yyyy-MM-") + "01").AddDays(-1) : Convert.ToDateTime(Request["data2"]) })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="control-label" for="totalizaConta">Totaliza por Conta</label>
                            <div class="input-group col-md-12">
                                @Html.DropDownList("totalizaConta", App_Dominio.Enumeracoes.DropDownListEnum.SimNao(Request["totalizaConta"] ?? "N"), new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="control-label" for="totalizaDia">Totaliza por Dia</label>
                            <div class="input-group col-md-12">
                                @Html.DropDownList("totalizaDia", App_Dominio.Enumeracoes.DropDownListEnum.SimNao(Request["totalizaDia"] ?? "N"), new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row clearfix">
                    <div class="col-md-12">
                        <div class="form-group">
                            <input type="submit" class="btn btn-primary" value="Buscar" id="btn-buscar" name="btn-buscar" onclick="return validaRazao();" />
                            <input type="button" class="btn btn-default" onclick="window.location = '../Contabilidade/Create'" value="Incluir" />
                        </div>
                    </div>
                </div>
            </div>
        }
        <div id="div-list-static2">
            @if (Model != null)
            {
                @Html.Partial("ListParam", Model)
            }
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#form000').submit(function () {
            if ($(this).valid()) {
                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: $(this).serialize(),
                    success: function (result) {
                        $('#div-list-static2').html(result);
                    }
                });
            }
            return false;
        });
    });

    function validaRazao() {
        if ($('#planoContaId').val() == null || $('#planoContaId').val() == '') {
            ShowMessageAjaxAlert('É preciso informar a conta para a emissão do Razão', 'warning');
            return false;
        }
        else
            return true;
    }


    //function validaPDF()
    //{
    //    if ($('#planoContaId').val() == null || $('#planoContaId').val() == '') {
    //        ShowMessageAlert('É preciso informar a conta para a emissão do Razão', 'warning');
    //        return false;
    //    }
    //    else
    //        return true;
    //}

</script>
